{"filter":false,"title":"application.py","tooltip":"~/workspace/finance/application.py","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":114,"column":0},"end":{"row":114,"column":4},"action":"insert","lines":["    "],"id":945}],[{"start":{"row":117,"column":8},"end":{"row":117,"column":12},"action":"remove","lines":["    "],"id":946},{"start":{"row":117,"column":4},"end":{"row":117,"column":8},"action":"remove","lines":["    "]}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"insert","lines":["    "],"id":947}],[{"start":{"row":116,"column":4},"end":{"row":116,"column":8},"action":"insert","lines":["    "],"id":948}],[{"start":{"row":114,"column":4},"end":{"row":114,"column":8},"action":"insert","lines":["    "],"id":949}],[{"start":{"row":114,"column":4},"end":{"row":114,"column":8},"action":"remove","lines":["    "],"id":950}],[{"start":{"row":115,"column":5},"end":{"row":115,"column":6},"action":"remove","lines":[" "],"id":951}],[{"start":{"row":115,"column":5},"end":{"row":115,"column":6},"action":"remove","lines":[" "],"id":952}],[{"start":{"row":115,"column":5},"end":{"row":115,"column":6},"action":"remove","lines":[" "],"id":953},{"start":{"row":115,"column":4},"end":{"row":115,"column":5},"action":"remove","lines":[" "]}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"insert","lines":["    "],"id":954}],[{"start":{"row":117,"column":4},"end":{"row":117,"column":8},"action":"insert","lines":["    "],"id":955}],[{"start":{"row":118,"column":4},"end":{"row":118,"column":8},"action":"insert","lines":["    "],"id":956}],[{"start":{"row":119,"column":4},"end":{"row":119,"column":8},"action":"insert","lines":["    "],"id":957}],[{"start":{"row":121,"column":4},"end":{"row":121,"column":8},"action":"insert","lines":["    "],"id":958}],[{"start":{"row":115,"column":8},"end":{"row":115,"column":12},"action":"insert","lines":["    "],"id":959}],[{"start":{"row":115,"column":8},"end":{"row":115,"column":12},"action":"remove","lines":["    "],"id":960},{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"remove","lines":["    "]}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"insert","lines":["    "],"id":961}],[{"start":{"row":115,"column":8},"end":{"row":116,"column":0},"action":"insert","lines":["",""],"id":962},{"start":{"row":116,"column":0},"end":{"row":116,"column":8},"action":"insert","lines":["        "]},{"start":{"row":116,"column":8},"end":{"row":117,"column":0},"action":"insert","lines":["",""]},{"start":{"row":117,"column":0},"end":{"row":117,"column":8},"action":"insert","lines":["        "]},{"start":{"row":117,"column":8},"end":{"row":118,"column":0},"action":"insert","lines":["",""]},{"start":{"row":118,"column":0},"end":{"row":118,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"remove","lines":["    "],"id":963},{"start":{"row":115,"column":0},"end":{"row":115,"column":4},"action":"remove","lines":["    "]},{"start":{"row":114,"column":32},"end":{"row":115,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":117,"column":4},"end":{"row":117,"column":8},"action":"remove","lines":["    "],"id":964},{"start":{"row":117,"column":0},"end":{"row":117,"column":4},"action":"remove","lines":["    "]},{"start":{"row":116,"column":8},"end":{"row":117,"column":0},"action":"remove","lines":["",""]},{"start":{"row":116,"column":4},"end":{"row":116,"column":8},"action":"remove","lines":["    "]},{"start":{"row":116,"column":0},"end":{"row":116,"column":4},"action":"remove","lines":["    "]},{"start":{"row":115,"column":8},"end":{"row":116,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":115,"column":8},"end":{"row":115,"column":12},"action":"insert","lines":["    "],"id":965}],[{"start":{"row":115,"column":12},"end":{"row":115,"column":16},"action":"insert","lines":["    "],"id":966}],[{"start":{"row":115,"column":16},"end":{"row":115,"column":20},"action":"insert","lines":["    "],"id":967}],[{"start":{"row":115,"column":16},"end":{"row":115,"column":20},"action":"remove","lines":["    "],"id":968},{"start":{"row":115,"column":12},"end":{"row":115,"column":16},"action":"remove","lines":["    "]},{"start":{"row":115,"column":8},"end":{"row":115,"column":12},"action":"remove","lines":["    "]},{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"remove","lines":["    "]}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"insert","lines":["    "],"id":969}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"remove","lines":["    "],"id":970}],[{"start":{"row":114,"column":4},"end":{"row":115,"column":0},"action":"insert","lines":["",""],"id":971},{"start":{"row":115,"column":0},"end":{"row":115,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":116,"column":4},"end":{"row":116,"column":8},"action":"insert","lines":["    "],"id":972}],[{"start":{"row":116,"column":8},"end":{"row":117,"column":0},"action":"insert","lines":["",""],"id":973},{"start":{"row":117,"column":0},"end":{"row":117,"column":8},"action":"insert","lines":["        "]},{"start":{"row":117,"column":8},"end":{"row":118,"column":0},"action":"insert","lines":["",""]},{"start":{"row":118,"column":0},"end":{"row":118,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":128,"column":4},"end":{"row":128,"column":13},"action":"remove","lines":["return re"],"id":974},{"start":{"row":128,"column":0},"end":{"row":128,"column":4},"action":"remove","lines":["    "]},{"start":{"row":127,"column":0},"end":{"row":128,"column":0},"action":"remove","lines":["",""]},{"start":{"row":126,"column":100},"end":{"row":127,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":114,"column":0},"end":{"row":114,"column":4},"action":"remove","lines":["    "],"id":975},{"start":{"row":113,"column":26},"end":{"row":114,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":117,"column":4},"end":{"row":117,"column":8},"action":"remove","lines":["    "],"id":976}],[{"start":{"row":115,"column":0},"end":{"row":115,"column":4},"action":"remove","lines":["    "],"id":977},{"start":{"row":114,"column":32},"end":{"row":115,"column":4},"action":"remove","lines":["","    "]}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"remove","lines":["    "],"id":978},{"start":{"row":115,"column":0},"end":{"row":115,"column":4},"action":"remove","lines":["    "]},{"start":{"row":114,"column":32},"end":{"row":115,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"insert","lines":["    "],"id":979}],[{"start":{"row":115,"column":4},"end":{"row":115,"column":8},"action":"remove","lines":["    "],"id":980}],[{"start":{"row":116,"column":4},"end":{"row":116,"column":8},"action":"remove","lines":["    "],"id":981}],[{"start":{"row":117,"column":4},"end":{"row":117,"column":8},"action":"remove","lines":["    "],"id":982}],[{"start":{"row":118,"column":4},"end":{"row":118,"column":8},"action":"remove","lines":["    "],"id":983}],[{"start":{"row":119,"column":4},"end":{"row":119,"column":8},"action":"remove","lines":["    "],"id":984}],[{"start":{"row":120,"column":4},"end":{"row":120,"column":8},"action":"remove","lines":["    "],"id":985}],[{"start":{"row":121,"column":4},"end":{"row":121,"column":8},"action":"remove","lines":["    "],"id":986}],[{"start":{"row":122,"column":0},"end":{"row":122,"column":4},"action":"remove","lines":["    "],"id":987}],[{"start":{"row":123,"column":4},"end":{"row":123,"column":8},"action":"remove","lines":["    "],"id":988},{"start":{"row":123,"column":0},"end":{"row":123,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":122,"column":0},"end":{"row":122,"column":4},"action":"insert","lines":["    "],"id":989}],[{"start":{"row":123,"column":0},"end":{"row":123,"column":4},"action":"insert","lines":["    "],"id":990}],[{"start":{"row":124,"column":0},"end":{"row":124,"column":4},"action":"insert","lines":["    "],"id":991}],[{"start":{"row":124,"column":0},"end":{"row":124,"column":4},"action":"remove","lines":["    "],"id":992}],[{"start":{"row":121,"column":4},"end":{"row":121,"column":8},"action":"insert","lines":["    "],"id":993}],[{"start":{"row":120,"column":4},"end":{"row":120,"column":8},"action":"insert","lines":["    "],"id":994}],[{"start":{"row":119,"column":4},"end":{"row":119,"column":8},"action":"insert","lines":["    "],"id":995}],[{"start":{"row":118,"column":4},"end":{"row":118,"column":8},"action":"insert","lines":["    "],"id":996}],[{"start":{"row":117,"column":4},"end":{"row":117,"column":8},"action":"insert","lines":["    "],"id":997}],[{"start":{"row":116,"column":4},"end":{"row":116,"column":8},"action":"insert","lines":["    "],"id":998}],[{"start":{"row":118,"column":8},"end":{"row":118,"column":12},"action":"insert","lines":["    "],"id":999}],[{"start":{"row":118,"column":8},"end":{"row":118,"column":12},"action":"remove","lines":["    "],"id":1000}],[{"start":{"row":119,"column":8},"end":{"row":119,"column":12},"action":"insert","lines":["    "],"id":1001}],[{"start":{"row":120,"column":8},"end":{"row":120,"column":12},"action":"insert","lines":["    "],"id":1002}],[{"start":{"row":120,"column":12},"end":{"row":120,"column":16},"action":"insert","lines":["    "],"id":1003}],[{"start":{"row":121,"column":8},"end":{"row":121,"column":12},"action":"insert","lines":["    "],"id":1004}],[{"start":{"row":121,"column":12},"end":{"row":121,"column":16},"action":"insert","lines":["    "],"id":1005}],[{"start":{"row":112,"column":12},"end":{"row":113,"column":0},"action":"insert","lines":["",""],"id":1006},{"start":{"row":113,"column":0},"end":{"row":113,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":113,"column":0},"end":{"row":113,"column":4},"action":"remove","lines":["    "],"id":1007},{"start":{"row":112,"column":12},"end":{"row":113,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":114,"column":4},"end":{"row":114,"column":32},"action":"remove","lines":["if request.method == \"POST\":"],"id":1008}],[{"start":{"row":112,"column":12},"end":{"row":113,"column":0},"action":"insert","lines":["",""],"id":1009},{"start":{"row":113,"column":0},"end":{"row":113,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":113,"column":4},"end":{"row":113,"column":32},"action":"insert","lines":["if request.method == \"POST\":"],"id":1010}],[{"start":{"row":115,"column":0},"end":{"row":115,"column":4},"action":"remove","lines":["    "],"id":1011},{"start":{"row":114,"column":26},"end":{"row":115,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":112,"column":0},"end":{"row":116,"column":40},"action":"remove","lines":["def quote():","    if request.method == \"POST\":","    \"\"\"Get stock quote.\"\"\"","    if not request.form.get(\"symbol\")","        return apology(\"Missing symbol\")"],"id":1012},{"start":{"row":112,"column":0},"end":{"row":117,"column":45},"action":"insert","lines":["def quote():","    ","    if request.method == \"POST\":","        \"\"\"Get stock quote.\"\"\"","        if not request.form.get(\"symbol\"):","            return apology(\"symbol required\")"]}],[{"start":{"row":120,"column":8},"end":{"row":120,"column":12},"action":"remove","lines":["    "],"id":1013},{"start":{"row":120,"column":4},"end":{"row":120,"column":8},"action":"remove","lines":["    "]}],[{"start":{"row":124,"column":4},"end":{"row":124,"column":8},"action":"insert","lines":["    "],"id":1014}],[{"start":{"row":123,"column":9},"end":{"row":124,"column":0},"action":"insert","lines":["",""],"id":1015},{"start":{"row":124,"column":0},"end":{"row":124,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":125,"column":4},"end":{"row":125,"column":8},"action":"remove","lines":["    "],"id":1016}],[{"start":{"row":113,"column":0},"end":{"row":113,"column":4},"action":"remove","lines":["    "],"id":1017},{"start":{"row":124,"column":0},"end":{"row":124,"column":8},"action":"remove","lines":["        "]}],[{"start":{"row":125,"column":4},"end":{"row":125,"column":8},"action":"insert","lines":["    "],"id":1018}],[{"start":{"row":125,"column":100},"end":{"row":126,"column":0},"action":"insert","lines":["",""],"id":1019},{"start":{"row":126,"column":0},"end":{"row":126,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":126,"column":0},"end":{"row":126,"column":8},"action":"remove","lines":["        "],"id":1020}],[{"start":{"row":112,"column":0},"end":{"row":125,"column":100},"action":"remove","lines":["def quote():","","    if request.method == \"POST\":","        \"\"\"Get stock quote.\"\"\"","        if not request.form.get(\"symbol\"):","            return apology(\"symbol required\")","        symbol = request.form.get(\"symbol\").upper()","        quote = lookup(symbol)","    if quote == None:","                return apology(\"Invalid symbol\")","                return redirect(url_for(\"index\"))","    else:","","        return render_template(\"quote.html\",name=quote[\"name\"], symbol=symbol, price=quote[\"price\"])"],"id":1021},{"start":{"row":112,"column":0},"end":{"row":126,"column":44},"action":"insert","lines":["def quote():","    ","    if request.method == \"POST\":","        \"\"\"Get stock quote.\"\"\"","        if not request.form.get(\"symbol\"):","            return apology(\"symbol required\")","        ","        quote = lookup(request.form.get(\"symbol\"))","        if quote == None:","            return apology(\"symbol not recognised\")","        else:","            return render_template(\"stock.html\", quote=quote)","    ","    else:","        return render_template(\"quote.html\")"]}],[{"start":{"row":113,"column":0},"end":{"row":113,"column":4},"action":"remove","lines":["    "],"id":1022},{"start":{"row":118,"column":0},"end":{"row":118,"column":8},"action":"remove","lines":["        "]},{"start":{"row":124,"column":0},"end":{"row":124,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":49,"column":0},"end":{"row":51,"column":26},"action":"remove","lines":["def buy():","    \"\"\"Buy shares of stock\"\"\"","    return apology(\"TODO\")"],"id":1023},{"start":{"row":49,"column":0},"end":{"row":88,"column":0},"action":"insert","lines":["def buy():","    ","    if request.method == \"POST\":","        ","        if not request.form.get(\"symbol\"):","            return apology(\"symbol required\")","            ","        elif not request.form.get(\"share_number\"):","            return apology(\"number of shares required\")","            ","        elif int(request.form.get(\"share_number\")) <= 0:","            return apology(\"number of shares must be positive integer\")","    ","        quote = lookup(request.form.get(\"symbol\"))","        if quote == None:","            return apology(\"symbol not recognised\")","        ","        today = datetime.datetime.now(timezone('Europe/London')).strftime(\"%e/%m/%Y %H:%M\")","        id = session.get(\"user_id\")","        cash = db.execute(\"SELECT cash FROM users WHERE id = :id\", id=id)[0][\"cash\"]","        share_number = int(request.form.get(\"share_number\"))","        cost = quote[\"price\"]*share_number","        ","        if cash < quote[\"price\"]:","            return apology(\"not enough cash\")","            ","        if cash >= quote[\"price\"]:","            result = db.execute(\"INSERT INTO portfolio (id, stock, price, date, share_number, symbol) VALUES(:id, :stock, :price, :date, :share, :symbol)\", id=id, stock=quote[\"name\"], price=quote[\"price\"], date=today, share=share_number, symbol=quote[\"symbol\"])","        if not result:","            return apology(\"unable to complete transaction\")","            ","        cash_update = db.execute(\"UPDATE users SET cash = cash - :cost WHERE id = :id\", cost=cost, id=id)","        if not cash_update:","            return apology(\"unable to update cash\")","        ","        return redirect(url_for(\"index\"))","            ","    else:","        return render_template(\"buy.html\")",""]}],[{"start":{"row":50,"column":0},"end":{"row":50,"column":4},"action":"remove","lines":["    "],"id":1024},{"start":{"row":52,"column":0},"end":{"row":52,"column":8},"action":"remove","lines":["        "]},{"start":{"row":55,"column":0},"end":{"row":55,"column":12},"action":"remove","lines":["            "]},{"start":{"row":58,"column":0},"end":{"row":58,"column":12},"action":"remove","lines":["            "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":4},"action":"remove","lines":["    "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":8},"action":"remove","lines":["        "]},{"start":{"row":71,"column":0},"end":{"row":71,"column":8},"action":"remove","lines":["        "]},{"start":{"row":74,"column":0},"end":{"row":74,"column":12},"action":"remove","lines":["            "]},{"start":{"row":79,"column":0},"end":{"row":79,"column":12},"action":"remove","lines":["            "]},{"start":{"row":83,"column":0},"end":{"row":83,"column":8},"action":"remove","lines":["        "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":12},"action":"remove","lines":["            "]}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":16},"action":"insert","lines":[" import datetime"],"id":1025}],[{"start":{"row":9,"column":1},"end":{"row":9,"column":7},"action":"remove","lines":["import"],"id":1026}],[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"remove","lines":["e"],"id":1027},{"start":{"row":9,"column":8},"end":{"row":9,"column":9},"action":"remove","lines":["m"]},{"start":{"row":9,"column":7},"end":{"row":9,"column":8},"action":"remove","lines":["i"]},{"start":{"row":9,"column":6},"end":{"row":9,"column":7},"action":"remove","lines":["t"]},{"start":{"row":9,"column":5},"end":{"row":9,"column":6},"action":"remove","lines":["e"]},{"start":{"row":9,"column":4},"end":{"row":9,"column":5},"action":"remove","lines":["t"]},{"start":{"row":9,"column":3},"end":{"row":9,"column":4},"action":"remove","lines":["a"]}],[{"start":{"row":9,"column":2},"end":{"row":9,"column":3},"action":"remove","lines":["d"],"id":1028},{"start":{"row":9,"column":1},"end":{"row":9,"column":2},"action":"remove","lines":[" "]},{"start":{"row":9,"column":0},"end":{"row":9,"column":1},"action":"remove","lines":[" "]},{"start":{"row":8,"column":58},"end":{"row":9,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":3,"column":84},"end":{"row":3,"column":85},"action":"insert","lines":[","],"id":1029}],[{"start":{"row":3,"column":85},"end":{"row":3,"column":86},"action":"insert","lines":[" "],"id":1030}],[{"start":{"row":3,"column":86},"end":{"row":3,"column":94},"action":"insert","lines":["datetime"],"id":1031}],[{"start":{"row":3,"column":86},"end":{"row":3,"column":94},"action":"remove","lines":["datetime"],"id":1032},{"start":{"row":3,"column":85},"end":{"row":3,"column":86},"action":"remove","lines":[" "]}],[{"start":{"row":3,"column":84},"end":{"row":3,"column":85},"action":"remove","lines":[","],"id":1033}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":25},"action":"insert","lines":["from pytz import timezone"],"id":1034}],[{"start":{"row":88,"column":0},"end":{"row":89,"column":0},"action":"remove","lines":["",""],"id":1040},{"start":{"row":87,"column":0},"end":{"row":88,"column":0},"action":"remove","lines":["",""]},{"start":{"row":86,"column":42},"end":{"row":87,"column":0},"action":"remove","lines":["",""]},{"start":{"row":86,"column":41},"end":{"row":86,"column":42},"action":"remove","lines":[")"]}],[{"start":{"row":86,"column":40},"end":{"row":86,"column":41},"action":"remove","lines":["\""],"id":1041},{"start":{"row":86,"column":39},"end":{"row":86,"column":40},"action":"remove","lines":["l"]},{"start":{"row":86,"column":38},"end":{"row":86,"column":39},"action":"remove","lines":["m"]},{"start":{"row":86,"column":37},"end":{"row":86,"column":38},"action":"remove","lines":["t"]},{"start":{"row":86,"column":36},"end":{"row":86,"column":37},"action":"remove","lines":["h"]},{"start":{"row":86,"column":35},"end":{"row":86,"column":36},"action":"remove","lines":["."]},{"start":{"row":86,"column":34},"end":{"row":86,"column":35},"action":"remove","lines":["y"]},{"start":{"row":86,"column":33},"end":{"row":86,"column":34},"action":"remove","lines":["u"]},{"start":{"row":86,"column":32},"end":{"row":86,"column":33},"action":"remove","lines":["b"]},{"start":{"row":86,"column":31},"end":{"row":86,"column":32},"action":"remove","lines":["\""]},{"start":{"row":86,"column":30},"end":{"row":86,"column":31},"action":"remove","lines":["("]},{"start":{"row":86,"column":29},"end":{"row":86,"column":30},"action":"remove","lines":["e"]},{"start":{"row":86,"column":28},"end":{"row":86,"column":29},"action":"remove","lines":["t"]},{"start":{"row":86,"column":27},"end":{"row":86,"column":28},"action":"remove","lines":["a"]},{"start":{"row":86,"column":26},"end":{"row":86,"column":27},"action":"remove","lines":["l"]},{"start":{"row":86,"column":25},"end":{"row":86,"column":26},"action":"remove","lines":["p"]},{"start":{"row":86,"column":24},"end":{"row":86,"column":25},"action":"remove","lines":["m"]},{"start":{"row":86,"column":23},"end":{"row":86,"column":24},"action":"remove","lines":["e"]},{"start":{"row":86,"column":22},"end":{"row":86,"column":23},"action":"remove","lines":["t"]},{"start":{"row":86,"column":21},"end":{"row":86,"column":22},"action":"remove","lines":["_"]},{"start":{"row":86,"column":20},"end":{"row":86,"column":21},"action":"remove","lines":["r"]},{"start":{"row":86,"column":19},"end":{"row":86,"column":20},"action":"remove","lines":["e"]},{"start":{"row":86,"column":18},"end":{"row":86,"column":19},"action":"remove","lines":["d"]},{"start":{"row":86,"column":17},"end":{"row":86,"column":18},"action":"remove","lines":["n"]},{"start":{"row":86,"column":16},"end":{"row":86,"column":17},"action":"remove","lines":["e"]},{"start":{"row":86,"column":15},"end":{"row":86,"column":16},"action":"remove","lines":["r"]},{"start":{"row":86,"column":14},"end":{"row":86,"column":15},"action":"remove","lines":[" "]},{"start":{"row":86,"column":13},"end":{"row":86,"column":14},"action":"remove","lines":["n"]},{"start":{"row":86,"column":12},"end":{"row":86,"column":13},"action":"remove","lines":["r"]},{"start":{"row":86,"column":11},"end":{"row":86,"column":12},"action":"remove","lines":["u"]},{"start":{"row":86,"column":10},"end":{"row":86,"column":11},"action":"remove","lines":["t"]},{"start":{"row":86,"column":9},"end":{"row":86,"column":10},"action":"remove","lines":["e"]},{"start":{"row":86,"column":8},"end":{"row":86,"column":9},"action":"remove","lines":["r"]},{"start":{"row":86,"column":4},"end":{"row":86,"column":8},"action":"remove","lines":["    "]},{"start":{"row":86,"column":0},"end":{"row":86,"column":4},"action":"remove","lines":["    "]},{"start":{"row":85,"column":9},"end":{"row":86,"column":0},"action":"remove","lines":["",""]},{"start":{"row":85,"column":8},"end":{"row":85,"column":9},"action":"remove","lines":[":"]},{"start":{"row":85,"column":7},"end":{"row":85,"column":8},"action":"remove","lines":["e"]},{"start":{"row":85,"column":6},"end":{"row":85,"column":7},"action":"remove","lines":["s"]},{"start":{"row":85,"column":5},"end":{"row":85,"column":6},"action":"remove","lines":["l"]},{"start":{"row":85,"column":4},"end":{"row":85,"column":5},"action":"remove","lines":["e"]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"remove","lines":["    "]},{"start":{"row":84,"column":0},"end":{"row":85,"column":0},"action":"remove","lines":["",""]},{"start":{"row":83,"column":41},"end":{"row":84,"column":0},"action":"remove","lines":["",""]},{"start":{"row":83,"column":40},"end":{"row":83,"column":41},"action":"remove","lines":[")"]},{"start":{"row":83,"column":39},"end":{"row":83,"column":40},"action":"remove","lines":[")"]},{"start":{"row":83,"column":38},"end":{"row":83,"column":39},"action":"remove","lines":["\""]},{"start":{"row":83,"column":37},"end":{"row":83,"column":38},"action":"remove","lines":["x"]},{"start":{"row":83,"column":36},"end":{"row":83,"column":37},"action":"remove","lines":["e"]},{"start":{"row":83,"column":35},"end":{"row":83,"column":36},"action":"remove","lines":["d"]},{"start":{"row":83,"column":34},"end":{"row":83,"column":35},"action":"remove","lines":["n"]},{"start":{"row":83,"column":33},"end":{"row":83,"column":34},"action":"remove","lines":["i"]},{"start":{"row":83,"column":32},"end":{"row":83,"column":33},"action":"remove","lines":["\""]},{"start":{"row":83,"column":31},"end":{"row":83,"column":32},"action":"remove","lines":["("]},{"start":{"row":83,"column":30},"end":{"row":83,"column":31},"action":"remove","lines":["r"]},{"start":{"row":83,"column":29},"end":{"row":83,"column":30},"action":"remove","lines":["o"]},{"start":{"row":83,"column":28},"end":{"row":83,"column":29},"action":"remove","lines":["f"]},{"start":{"row":83,"column":27},"end":{"row":83,"column":28},"action":"remove","lines":["_"]},{"start":{"row":83,"column":26},"end":{"row":83,"column":27},"action":"remove","lines":["l"]},{"start":{"row":83,"column":25},"end":{"row":83,"column":26},"action":"remove","lines":["r"]},{"start":{"row":83,"column":24},"end":{"row":83,"column":25},"action":"remove","lines":["u"]},{"start":{"row":83,"column":23},"end":{"row":83,"column":24},"action":"remove","lines":["("]},{"start":{"row":83,"column":22},"end":{"row":83,"column":23},"action":"remove","lines":["t"]},{"start":{"row":83,"column":21},"end":{"row":83,"column":22},"action":"remove","lines":["c"]},{"start":{"row":83,"column":20},"end":{"row":83,"column":21},"action":"remove","lines":["e"]},{"start":{"row":83,"column":19},"end":{"row":83,"column":20},"action":"remove","lines":["r"]},{"start":{"row":83,"column":18},"end":{"row":83,"column":19},"action":"remove","lines":["i"]},{"start":{"row":83,"column":17},"end":{"row":83,"column":18},"action":"remove","lines":["d"]},{"start":{"row":83,"column":16},"end":{"row":83,"column":17},"action":"remove","lines":["e"]},{"start":{"row":83,"column":15},"end":{"row":83,"column":16},"action":"remove","lines":["r"]},{"start":{"row":83,"column":14},"end":{"row":83,"column":15},"action":"remove","lines":[" "]},{"start":{"row":83,"column":13},"end":{"row":83,"column":14},"action":"remove","lines":["n"]},{"start":{"row":83,"column":12},"end":{"row":83,"column":13},"action":"remove","lines":["r"]},{"start":{"row":83,"column":11},"end":{"row":83,"column":12},"action":"remove","lines":["u"]},{"start":{"row":83,"column":10},"end":{"row":83,"column":11},"action":"remove","lines":["t"]},{"start":{"row":83,"column":9},"end":{"row":83,"column":10},"action":"remove","lines":["e"]},{"start":{"row":83,"column":8},"end":{"row":83,"column":9},"action":"remove","lines":["r"]},{"start":{"row":83,"column":4},"end":{"row":83,"column":8},"action":"remove","lines":["    "]},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"remove","lines":["    "]},{"start":{"row":82,"column":0},"end":{"row":83,"column":0},"action":"remove","lines":["",""]},{"start":{"row":81,"column":51},"end":{"row":82,"column":0},"action":"remove","lines":["",""]},{"start":{"row":81,"column":50},"end":{"row":81,"column":51},"action":"remove","lines":[")"]},{"start":{"row":81,"column":49},"end":{"row":81,"column":50},"action":"remove","lines":["\""]}],[{"start":{"row":81,"column":48},"end":{"row":81,"column":49},"action":"remove","lines":["h"],"id":1042},{"start":{"row":81,"column":47},"end":{"row":81,"column":48},"action":"remove","lines":["s"]},{"start":{"row":81,"column":46},"end":{"row":81,"column":47},"action":"remove","lines":["a"]},{"start":{"row":81,"column":45},"end":{"row":81,"column":46},"action":"remove","lines":["c"]},{"start":{"row":81,"column":44},"end":{"row":81,"column":45},"action":"remove","lines":[" "]},{"start":{"row":81,"column":43},"end":{"row":81,"column":44},"action":"remove","lines":["e"]},{"start":{"row":81,"column":42},"end":{"row":81,"column":43},"action":"remove","lines":["t"]},{"start":{"row":81,"column":41},"end":{"row":81,"column":42},"action":"remove","lines":["a"]},{"start":{"row":81,"column":40},"end":{"row":81,"column":41},"action":"remove","lines":["d"]},{"start":{"row":81,"column":39},"end":{"row":81,"column":40},"action":"remove","lines":["p"]},{"start":{"row":81,"column":38},"end":{"row":81,"column":39},"action":"remove","lines":["u"]},{"start":{"row":81,"column":37},"end":{"row":81,"column":38},"action":"remove","lines":[" "]},{"start":{"row":81,"column":36},"end":{"row":81,"column":37},"action":"remove","lines":["o"]},{"start":{"row":81,"column":35},"end":{"row":81,"column":36},"action":"remove","lines":["t"]},{"start":{"row":81,"column":34},"end":{"row":81,"column":35},"action":"remove","lines":[" "]},{"start":{"row":81,"column":33},"end":{"row":81,"column":34},"action":"remove","lines":["e"]},{"start":{"row":81,"column":32},"end":{"row":81,"column":33},"action":"remove","lines":["l"]},{"start":{"row":81,"column":31},"end":{"row":81,"column":32},"action":"remove","lines":["b"]},{"start":{"row":81,"column":30},"end":{"row":81,"column":31},"action":"remove","lines":["a"]},{"start":{"row":81,"column":29},"end":{"row":81,"column":30},"action":"remove","lines":["n"]},{"start":{"row":81,"column":28},"end":{"row":81,"column":29},"action":"remove","lines":["u"]},{"start":{"row":81,"column":27},"end":{"row":81,"column":28},"action":"remove","lines":["\""]},{"start":{"row":81,"column":26},"end":{"row":81,"column":27},"action":"remove","lines":["("]},{"start":{"row":81,"column":25},"end":{"row":81,"column":26},"action":"remove","lines":["y"]},{"start":{"row":81,"column":24},"end":{"row":81,"column":25},"action":"remove","lines":["g"]},{"start":{"row":81,"column":23},"end":{"row":81,"column":24},"action":"remove","lines":["o"]},{"start":{"row":81,"column":22},"end":{"row":81,"column":23},"action":"remove","lines":["l"]},{"start":{"row":81,"column":21},"end":{"row":81,"column":22},"action":"remove","lines":["o"]},{"start":{"row":81,"column":20},"end":{"row":81,"column":21},"action":"remove","lines":["p"]},{"start":{"row":81,"column":19},"end":{"row":81,"column":20},"action":"remove","lines":["a"]},{"start":{"row":81,"column":18},"end":{"row":81,"column":19},"action":"remove","lines":[" "]},{"start":{"row":81,"column":17},"end":{"row":81,"column":18},"action":"remove","lines":["n"]},{"start":{"row":81,"column":16},"end":{"row":81,"column":17},"action":"remove","lines":["r"]},{"start":{"row":81,"column":15},"end":{"row":81,"column":16},"action":"remove","lines":["u"]},{"start":{"row":81,"column":14},"end":{"row":81,"column":15},"action":"remove","lines":["t"]},{"start":{"row":81,"column":13},"end":{"row":81,"column":14},"action":"remove","lines":["e"]},{"start":{"row":81,"column":12},"end":{"row":81,"column":13},"action":"remove","lines":["r"]},{"start":{"row":81,"column":8},"end":{"row":81,"column":12},"action":"remove","lines":["    "]},{"start":{"row":81,"column":4},"end":{"row":81,"column":8},"action":"remove","lines":["    "]},{"start":{"row":81,"column":0},"end":{"row":81,"column":4},"action":"remove","lines":["    "]},{"start":{"row":80,"column":27},"end":{"row":81,"column":0},"action":"remove","lines":["",""]},{"start":{"row":80,"column":26},"end":{"row":80,"column":27},"action":"remove","lines":[":"]},{"start":{"row":80,"column":25},"end":{"row":80,"column":26},"action":"remove","lines":["e"]},{"start":{"row":80,"column":24},"end":{"row":80,"column":25},"action":"remove","lines":["t"]},{"start":{"row":80,"column":23},"end":{"row":80,"column":24},"action":"remove","lines":["a"]},{"start":{"row":80,"column":22},"end":{"row":80,"column":23},"action":"remove","lines":["d"]},{"start":{"row":80,"column":21},"end":{"row":80,"column":22},"action":"remove","lines":["p"]},{"start":{"row":80,"column":20},"end":{"row":80,"column":21},"action":"remove","lines":["u"]},{"start":{"row":80,"column":19},"end":{"row":80,"column":20},"action":"remove","lines":["_"]},{"start":{"row":80,"column":18},"end":{"row":80,"column":19},"action":"remove","lines":["h"]},{"start":{"row":80,"column":17},"end":{"row":80,"column":18},"action":"remove","lines":["s"]},{"start":{"row":80,"column":16},"end":{"row":80,"column":17},"action":"remove","lines":["a"]},{"start":{"row":80,"column":15},"end":{"row":80,"column":16},"action":"remove","lines":["c"]},{"start":{"row":80,"column":14},"end":{"row":80,"column":15},"action":"remove","lines":[" "]},{"start":{"row":80,"column":13},"end":{"row":80,"column":14},"action":"remove","lines":["t"]},{"start":{"row":80,"column":12},"end":{"row":80,"column":13},"action":"remove","lines":["o"]},{"start":{"row":80,"column":11},"end":{"row":80,"column":12},"action":"remove","lines":["n"]},{"start":{"row":80,"column":10},"end":{"row":80,"column":11},"action":"remove","lines":[" "]},{"start":{"row":80,"column":9},"end":{"row":80,"column":10},"action":"remove","lines":["f"]},{"start":{"row":80,"column":8},"end":{"row":80,"column":9},"action":"remove","lines":["i"]},{"start":{"row":80,"column":4},"end":{"row":80,"column":8},"action":"remove","lines":["    "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"remove","lines":["    "]},{"start":{"row":79,"column":105},"end":{"row":80,"column":0},"action":"remove","lines":["",""]},{"start":{"row":79,"column":104},"end":{"row":79,"column":105},"action":"remove","lines":[")"]},{"start":{"row":79,"column":103},"end":{"row":79,"column":104},"action":"remove","lines":["d"]},{"start":{"row":79,"column":102},"end":{"row":79,"column":103},"action":"remove","lines":["i"]},{"start":{"row":79,"column":101},"end":{"row":79,"column":102},"action":"remove","lines":["="]},{"start":{"row":79,"column":100},"end":{"row":79,"column":101},"action":"remove","lines":["d"]},{"start":{"row":79,"column":99},"end":{"row":79,"column":100},"action":"remove","lines":["i"]},{"start":{"row":79,"column":98},"end":{"row":79,"column":99},"action":"remove","lines":[" "]},{"start":{"row":79,"column":97},"end":{"row":79,"column":98},"action":"remove","lines":[","]},{"start":{"row":79,"column":96},"end":{"row":79,"column":97},"action":"remove","lines":["t"]},{"start":{"row":79,"column":95},"end":{"row":79,"column":96},"action":"remove","lines":["s"]},{"start":{"row":79,"column":94},"end":{"row":79,"column":95},"action":"remove","lines":["o"]},{"start":{"row":79,"column":93},"end":{"row":79,"column":94},"action":"remove","lines":["c"]},{"start":{"row":79,"column":92},"end":{"row":79,"column":93},"action":"remove","lines":["="]},{"start":{"row":79,"column":91},"end":{"row":79,"column":92},"action":"remove","lines":["t"]},{"start":{"row":79,"column":90},"end":{"row":79,"column":91},"action":"remove","lines":["s"]},{"start":{"row":79,"column":89},"end":{"row":79,"column":90},"action":"remove","lines":["o"]},{"start":{"row":79,"column":88},"end":{"row":79,"column":89},"action":"remove","lines":["c"]},{"start":{"row":79,"column":87},"end":{"row":79,"column":88},"action":"remove","lines":[" "]},{"start":{"row":79,"column":86},"end":{"row":79,"column":87},"action":"remove","lines":[","]},{"start":{"row":79,"column":85},"end":{"row":79,"column":86},"action":"remove","lines":["\""]}],[{"start":{"row":79,"column":84},"end":{"row":79,"column":85},"action":"remove","lines":["d"],"id":1043},{"start":{"row":79,"column":83},"end":{"row":79,"column":84},"action":"remove","lines":["i"]},{"start":{"row":79,"column":82},"end":{"row":79,"column":83},"action":"remove","lines":[":"]},{"start":{"row":79,"column":81},"end":{"row":79,"column":82},"action":"remove","lines":[" "]},{"start":{"row":79,"column":80},"end":{"row":79,"column":81},"action":"remove","lines":["="]},{"start":{"row":79,"column":79},"end":{"row":79,"column":80},"action":"remove","lines":[" "]},{"start":{"row":79,"column":78},"end":{"row":79,"column":79},"action":"remove","lines":["d"]},{"start":{"row":79,"column":77},"end":{"row":79,"column":78},"action":"remove","lines":["i"]},{"start":{"row":79,"column":76},"end":{"row":79,"column":77},"action":"remove","lines":[" "]},{"start":{"row":79,"column":75},"end":{"row":79,"column":76},"action":"remove","lines":["E"]},{"start":{"row":79,"column":74},"end":{"row":79,"column":75},"action":"remove","lines":["R"]},{"start":{"row":79,"column":73},"end":{"row":79,"column":74},"action":"remove","lines":["E"]},{"start":{"row":79,"column":72},"end":{"row":79,"column":73},"action":"remove","lines":["H"]},{"start":{"row":79,"column":71},"end":{"row":79,"column":72},"action":"remove","lines":["W"]},{"start":{"row":79,"column":70},"end":{"row":79,"column":71},"action":"remove","lines":[" "]},{"start":{"row":79,"column":69},"end":{"row":79,"column":70},"action":"remove","lines":["t"]},{"start":{"row":79,"column":68},"end":{"row":79,"column":69},"action":"remove","lines":["s"]},{"start":{"row":79,"column":67},"end":{"row":79,"column":68},"action":"remove","lines":["o"]},{"start":{"row":79,"column":66},"end":{"row":79,"column":67},"action":"remove","lines":["c"]},{"start":{"row":79,"column":65},"end":{"row":79,"column":66},"action":"remove","lines":[":"]},{"start":{"row":79,"column":64},"end":{"row":79,"column":65},"action":"remove","lines":[" "]},{"start":{"row":79,"column":63},"end":{"row":79,"column":64},"action":"remove","lines":["-"]},{"start":{"row":79,"column":62},"end":{"row":79,"column":63},"action":"remove","lines":[" "]},{"start":{"row":79,"column":61},"end":{"row":79,"column":62},"action":"remove","lines":["h"]},{"start":{"row":79,"column":60},"end":{"row":79,"column":61},"action":"remove","lines":["s"]},{"start":{"row":79,"column":59},"end":{"row":79,"column":60},"action":"remove","lines":["a"]},{"start":{"row":79,"column":58},"end":{"row":79,"column":59},"action":"remove","lines":["c"]},{"start":{"row":79,"column":57},"end":{"row":79,"column":58},"action":"remove","lines":[" "]},{"start":{"row":79,"column":56},"end":{"row":79,"column":57},"action":"remove","lines":["="]},{"start":{"row":79,"column":55},"end":{"row":79,"column":56},"action":"remove","lines":[" "]},{"start":{"row":79,"column":54},"end":{"row":79,"column":55},"action":"remove","lines":["h"]},{"start":{"row":79,"column":53},"end":{"row":79,"column":54},"action":"remove","lines":["s"]},{"start":{"row":79,"column":52},"end":{"row":79,"column":53},"action":"remove","lines":["a"]},{"start":{"row":79,"column":51},"end":{"row":79,"column":52},"action":"remove","lines":["c"]},{"start":{"row":79,"column":50},"end":{"row":79,"column":51},"action":"remove","lines":[" "]},{"start":{"row":79,"column":49},"end":{"row":79,"column":50},"action":"remove","lines":["T"]},{"start":{"row":79,"column":48},"end":{"row":79,"column":49},"action":"remove","lines":["E"]},{"start":{"row":79,"column":47},"end":{"row":79,"column":48},"action":"remove","lines":["S"]}],[{"start":{"row":49,"column":0},"end":{"row":79,"column":47},"action":"remove","lines":["","    if request.method == \"POST\":","","        if not request.form.get(\"symbol\"):","            return apology(\"symbol required\")","","        elif not request.form.get(\"share_number\"):","            return apology(\"number of shares required\")","","        elif int(request.form.get(\"share_number\")) <= 0:","            return apology(\"number of shares must be positive integer\")","","        quote = lookup(request.form.get(\"symbol\"))","        if quote == None:","            return apology(\"symbol not recognised\")","","        today = datetime.datetime.now(timezone('Europe/London')).strftime(\"%e/%m/%Y %H:%M\")","        id = session.get(\"user_id\")","        cash = db.execute(\"SELECT cash FROM users WHERE id = :id\", id=id)[0][\"cash\"]","        share_number = int(request.form.get(\"share_number\"))","        cost = quote[\"price\"]*share_number","","        if cash < quote[\"price\"]:","            return apology(\"not enough cash\")","","        if cash >= quote[\"price\"]:","            result = db.execute(\"INSERT INTO portfolio (id, stock, price, date, share_number, symbol) VALUES(:id, :stock, :price, :date, :share, :symbol)\", id=id, stock=quote[\"name\"], price=quote[\"price\"], date=today, share=share_number, symbol=quote[\"symbol\"])","        if not result:","            return apology(\"unable to complete transaction\")","","        cash_update = db.execute(\"UPDATE users "],"id":1044},{"start":{"row":48,"column":10},"end":{"row":49,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":48,"column":10},"end":{"row":49,"column":0},"action":"insert","lines":["",""],"id":1045},{"start":{"row":49,"column":0},"end":{"row":49,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":49,"column":4},"end":{"row":83,"column":0},"action":"insert","lines":["def buy():","    \"\"\"Buy shares of stock.\"\"\"","    if request.method == \"POST\":","        # check if valid input","        try:","            symbol = lookup(request.form.get(\"symbol\"))","            shares = int(request.form.get(\"shares\"))","        except:","            return apology(\"enter some input\")","        ","        # if symbol is empty return apology","        if not symbol:","            return apology(\"enter a valid symbol\")","            ","        # if shares is empty","        if not shares or shares <= 0:","            return apology(\"enter the quantity of shares\")","            ","        # if can't afford to buy then error","        # get cash from db","        cashOnHand = db.execute(\"SELECT cash FROM users WHERE id=:user_id;\", user_id=session[\"user_id\"])","        cashOnHand = int(cashOnHand[0]['cash'])","        if (shares * symbol['price']) > cashOnHand:","            return apology(\"can't afford\")","        else:","            db.execute(\"INSERT INTO transactions (symbol, quantity, price, u_id) VALUES (:symbol, :quantity, :price, :u_id);\", \\","            symbol=symbol['symbol'], quantity=shares, price=symbol['price'], u_id=session[\"user_id\"])","            # update cash (define old_balance)","            db.execute(\"UPDATE users SET cash=cash-:total_price WHERE id=:user_id;\", total_price=shares*symbol['price'], \\","            user_id=session[\"user_id\"])","            return redirect(url_for(\"index\"))","        ","    else:","        return render_template(\"buy.html\")",""],"id":1046}],[{"start":{"row":82,"column":42},"end":{"row":83,"column":0},"action":"remove","lines":["",""],"id":1047}],[{"start":{"row":49,"column":5},"end":{"row":49,"column":14},"action":"remove","lines":["ef buy():"],"id":1048},{"start":{"row":49,"column":4},"end":{"row":49,"column":5},"action":"remove","lines":["d"]},{"start":{"row":49,"column":0},"end":{"row":49,"column":4},"action":"remove","lines":["    "]},{"start":{"row":48,"column":10},"end":{"row":49,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":8},"action":"remove","lines":["        "],"id":1049},{"start":{"row":61,"column":0},"end":{"row":61,"column":12},"action":"remove","lines":["            "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":12},"action":"remove","lines":["            "]},{"start":{"row":79,"column":0},"end":{"row":79,"column":8},"action":"remove","lines":["        "]}],[{"start":{"row":9,"column":25},"end":{"row":10,"column":0},"action":"insert","lines":["",""],"id":1050}]]},"ace":{"folds":[],"scrolltop":1283,"scrollleft":0,"selection":{"start":{"row":93,"column":0},"end":{"row":93,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1538684179000,"hash":"55bd6551b08c26e0266bf7d94ea4d385b9f8408f"}